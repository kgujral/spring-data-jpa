define('util/constants',['backbone'],function(a){return{TEXT:{DELIMITER:' ',INVALID_DATA:"The data must start with a 'P' or a 'Q' and must be followed by keywords separated by spaces.",ADDED_SUCCESSFULLY:'Added Successfully !'},EVENTS:{PAGE_ADDED:'page.added',QUERY_ADDED:'query.added',DATA_CLEARED:'data.cleared'},KEYWORD_PAGE_INDEX:{},VENT:_.extend({},a.Events),TOTAL_KEYWORDS:8}}),define('util/preProcessor',['util/constants'],function(a){function b(b,f,i){var a={page:f.page.clone(),weight:f.weight};a.weight*=i;var e=c(b,a);if(e!=-1){var g=b.splice(e,1);a.weight+=g[0].weight}var h=d(b,a);b.splice(h,0,a)}function c(b,d){for(var a=0;a<b.length;a++){var c=b[a];if(c.page.get('id')===d.page.get('id'))return a}return-1}function d(c,b){var a=0;return _.each(c,function(c){if(c.weight>b.weight)a++;else if(c.weight==b.weight&&c.page.get('name')<b.page.get('name'))a++;else return a}),a}return{createIndex:function(c){var d=c.get('keywords');for(var b=0;b<d.length;b++){var e=d[b].toLowerCase();var f={page:c,weight:a.TOTAL_KEYWORDS-b};var g=a.KEYWORD_PAGE_INDEX[e];g?g.push(f):a.KEYWORD_PAGE_INDEX[e]=[f]}console.log('created index for '+c.toString())},searchPages:function(i){var f=i.get('keywords');var g=[];for(var c=0;c<f.length;c++){var h=f[c].toLowerCase();var d=a.KEYWORD_PAGE_INDEX[h];if(d)for(var e=0;e<d.length;e++)b(g,d[e],a.TOTAL_KEYWORDS-c)}return g.slice(0,5)}}}),define('templates/addData.html',function(){return unescape('%3Cform%20id%3D%22add-data-form%22%20class%3D%22form-horizontal%22%3E%0D%0A%09%3Cdiv%20class%3D%22control-group%22%3E%0D%0A%09%09%3Clabel%20class%3D%22control-label%22%20for%3D%22inputPassword%22%3EPage%20or%20Query%20Data%3C/label%3E%0D%0A%09%09%3Cdiv%20class%3D%22controls%22%3E%0D%0A%09%09%09%3Cinput%20id%3D%22data-text%22%20type%3D%22text%22%20class%3D%22span5%22%20placeholder%3D%22enter%20query%20or%20page%20details%22%20autofocus%3E%0D%0A%09%09%09%3Cbutton%20type%3D%22submit%22%20class%3D%22btn%20btn-primary%22%20id%3D%22add%22%3EAdd%3C/button%3E%0D%0A%09%09%09%3Cbutton%20id%3D%22reset-all%22%20type%3D%22button%22%20class%3D%22btn%20btn-danger%22%3EClear%20All%3C/button%3E%0D%0A%09%09%3C/div%3E%0D%0A%09%3C/div%3E%0D%0A%3C/form%3E%0D%0A')}),define('models/query',['underscore','backbone','localStorage'],function(d,b,c){var a=b.Model.extend({localStorage:new c('Query'),init:function(a){this.name=a.name||'',this.keywords=a.keywords||[]},toString:function(){return'[name='+this.get('name')+', keywords='+this.get('keywords')+']'}});return a}),define('models/page',['underscore','backbone','localStorage'],function(d,b,c){var a=b.Model.extend({localStorage:new c('Page'),init:function(a){this.name=a.name||'',this.keywords=a.keywords||[]},toString:function(){return this.get('name')}});return a}),define('collections/pages',['backbone','models/page','localStorage'],function(b,c,d){var a=b.Collection.extend({localStorage:new d('Page'),model:c});return a}),define('collections/queries',['backbone','models/query','localStorage'],function(b,c,d){var a=b.Collection.extend({localStorage:new d('Query'),model:c});return a}),define('views/addDataView',['jquery','underscore','backbone','templates/addData.html','models/query','models/page','collections/pages','collections/queries','util/preProcessor','util/constants','localStorage'],function(b,e,k,j,h,g,n,o,i,a,c){function l(a,d){var c=/^[p|q][\s].+/;if(!c.test(a.toLowerCase()))throw'Invalid input string :'+a;var b=m(a,d);b.save(),console.log('Saved '+b)}function m(d,c){var b;return d.toLowerCase().indexOf('p')==0?(c.pageCount++,b=new g({name:'P'+c.pageCount,keywords:f(d)}),i.createIndex(b),a.VENT.trigger(a.EVENTS.PAGE_ADDED,b)):(c.queryCount++,b=new h({name:'Q'+c.queryCount,keywords:f(d)}),a.VENT.trigger(a.EVENTS.QUERY_ADDED,b)),b}function f(b){return b=b.substring(2).trim().replace(/\s\s+/g,' '),b.split(a.TEXT.DELIMITER)}var d=k.View.extend({el:b('#add-data'),initialize:function(a){e.bindAll(this),this.pages=a.pages,this.queries=a.queries,this.$alert=b('.alert'),this.queryCount=this.queries.length,this.pageCount=this.pages.length},events:{'submit #add-data-form':'addData','click #reset-all':'resetStorage'},render:function(){var a=e.template(j);this.$el.append(a)},close:function(){this.undelegateEvents()},addData:function(d){d.preventDefault(),this.$alert.hide();var c=b('#data-text');try{l(c.val(),this),c.val(''),this.$alert.removeClass('alert-error').addClass('alert-success').html(a.TEXT.ADDED_SUCCESSFULLY)}catch(b){this.$alert.removeClass('alert-success').addClass('alert-error').html(a.TEXT.INVALID_DATA)}return this.$alert.fadeIn(),!1},resetStorage:function(){new c('Page')._clear(),new c('Query')._clear(),a.VENT.trigger(a.EVENTS.DATA_CLEARED),this.queryCount=0,this.pageCount=0,console.log('All queries and pages cleared.')}});return d}),define('templates/queryListView.html',function(){return unescape('%3Ch5%20class%3D%22muted%22%3EExisting%20Queries%20%3Cspan%20style%3D%27float%3A%20right%3B%27%3EQuery%20Result%3C/span%3E%3C/h5%3E%0D%0A%3Chr%20style%3D%22margin%3A%200%22%3E%0D%0A%3Cdl%20class%3D%22dl-horizontal%22%20id%3D%27query-list%27%3E%0D%0A%0D%0A%3C/dl%3E%0D%0A')}),define('templates/queryView.html',function(){return unescape('%3Cdt%20class%3D%27run-query%27%3E%3Ca%20href%3D%27%23%27%3E%3C%25%3D%20query.name%20%25%3E%3C/a%3E%3C/dt%3E%0D%0A%3Cdd%20span%20class%3D%27muted%27%3E%3C%25%3D%20query.keywords%20%25%3E%3Cspan%20style%3D%27float%3A%20right%3B%27%20class%3D%27query-result%27%3EClick%20on%20the%20query%20name%20to%20execute%3C/span%3E%3C/dd%3E%0D%0A')}),define('views/queryView',['jquery','underscore','backbone','templates/queryView.html','util/preProcessor','models/query'],function(f,a,c,d,e,g){var b=c.View.extend({initialize:function(){a.bindAll(this)},render:function(){var b=a.template(d,{query:this.model.toJSON()});return this.$el.html(b),this},events:{'click .run-query':'searchPages'},searchPages:function(){var b=a.pluck(e.searchPages(this.model),'page').toString();return this.$('.query-result').html(b||'No Pages found!'),!1}});return b}),define('views/queryListView',['jquery','underscore','backbone','templates/queryListView.html','util/constants','views/queryView'],function(b,c,e,f,a,g){function h(b,c){a.VENT.on(a.EVENTS.QUERY_ADDED,b),a.VENT.on(a.EVENTS.DATA_CLEARED,c)}var d=e.View.extend({el:b('#queries'),initialize:function(a){c.bindAll(this),this.queries=a.queries,this.listenTo(this.queries,'add',this.addOne),this.listenTo(this.queries,'reset',this.render),h(this.addQuery,this.clearAll)},render:function(){var a=c.template(f);this.$el.html(a),this.addAll()},events:{},addQuery:function(a){this.queries.add(a)},clearAll:function(){this.queries.reset()},addOne:function(c){var a=new g({model:c});b('#query-list').append(a.render().el)},addAll:function(){this.queries.each(this.addOne,this)}});return d}),define('templates/pageListView.html',function(){return unescape('%3Ch5%20class%3D%22muted%22%3EExisting%20Pages%3C/h5%3E%0D%0A%3Chr%20style%3D%22margin%3A%200%22%3E%0D%0A%3Cdl%20class%3D%22dl-horizontal%22%20id%3D%27page-list%27%3E%0D%0A%0D%0A%3C/dl%3E%0D%0A')}),define('templates/pageView.html',function(){return unescape('%3Cdt%3E%3C%25%3D%20page.name%20%25%3E%3C/dt%3E%0D%0A%3Cdd%3E%3C%25%3D%20page.keywords%20%25%3E%3C/dd%3E')}),define('views/pageView',['jquery','underscore','backbone','templates/pageView.html'],function(e,a,c,d){var b=c.View.extend({initialize:function(){a.bindAll(this)},render:function(){var b=a.template(d,{page:this.model.toJSON()});return this.$el.html(b),this}});return b}),define('views/pageListView',['jquery','underscore','backbone','templates/pageListView.html','util/constants','views/pageView'],function(b,c,e,f,a,g){function h(b,c){a.VENT.on(a.EVENTS.PAGE_ADDED,b),a.VENT.on(a.EVENTS.DATA_CLEARED,c)}var d=e.View.extend({el:b('#pages'),initialize:function(a){c.bindAll(this),this.pages=a.pages,this.listenTo(this.pages,'add',this.addOne),this.listenTo(this.pages,'reset',this.render),h(this.addPage,this.clearAll)},render:function(){var a=c.template(f);this.$el.html(a),this.addAll()},events:{},addPage:function(a){this.pages.add(a)},clearAll:function(){this.pages.reset()},addOne:function(c){var a=new g({model:c});b('#page-list').append(a.render().el)},addAll:function(){this.pages.each(this.addOne,this)}});return d}),define('controller/router',['backbone','util/preProcessor','views/addDataView','views/queryListView','views/pageListView','collections/queries','collections/pages'],function(b,j,d,e,f,g,h){function i(a,b){console.log('Setting up initial data from local storage.'),a.fetch(),b.fetch(),a.each(function(a){console.log('Creating index for already existing page: '+a.toString()),j.createIndex(a)}),console.log('Existing queries : '),b.each(function(a){console.log(a.toString())}),console.log('Initial data setup completed.')}var c=b.Router.extend({routes:{'':'showHome'},showHome:function(){var a=new g;var b=new h;i(b,a),new d({pages:b,queries:a}).render(),new e({queries:a}).render(),new f({pages:b}).render()}});var a=function(){new c,b.history.start()};return{initialize:a}}),require.config({urlArgs:'ver='+new Date().getTime(),paths:{jquery:'libs/jquery-1.8.3',backbone:'libs/backbone-0.9.9-min',underscore:'libs/underscore-1.4.4-min',localStorage:'libs/backbone.localStorage-min'},shim:{underscore:{exports:'_'},backbone:{deps:['underscore','jquery'],exports:'Backbone'}}}),require(['controller/router'],function(a){a.initialize()});var myloaderconfig={paths:{},baseUrl:'./',AMDLoaderConfiguration:{}}